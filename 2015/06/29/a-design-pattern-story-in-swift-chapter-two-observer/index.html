<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      A Design Pattern Story in Swift &#8211; Chapter 2: Observer &middot; Audrey Li's Personal Blog
    
  </title>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <link rel='stylesheet' href='http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css'>

  <link rel="stylesheet" type="text/css" href="/assets/bootstrap/css/bootstrap-theme.css">
  <link rel="stylesheet" type="text/css" href="/assets/bootstrap/css/bootstrap.css">

 
  <!-- CSS -->
  <!-- build:css /assets/stylesheets/style.min.css -->
  <link rel="stylesheet" href="/assets/stylesheets/style.css">
  <!-- endbuild -->
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=RobotoDraft:100,300,400|Roboto:300,300italic,400">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/assets/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/assets/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/assets/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/assets/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/assets/images/favicons/manifest.json">
  <meta name="apple-mobile-web-app-title" content="Audrey's Blog">
  <meta name="application-name" content="Audrey's Blog">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/assets/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

</head>

  
  <body>
    <nav id="push_sidebar">
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="#">Portfolio</a></li>
      <li><a href="/archive">Archive</a></li>
      <li><a href="/about">About</a></li>
    </ul>
    
    <div class="social-icons">
        <img src="/assets/images/audrey-li.jpg" alt="Audrey's Photo" class="img-circle">

        <a href="https://github.com/vidaaudrey" title="Audrey's Github">
            <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-github fa-stack-1x fa-inverse"></i>
            </span>

        <a href="https://www.facebook.com/audreyauli" title="Audrey's Facebook">
            <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
            </span>
        </a>
    
        <a href="https://google.com/+AudreyLiSF" title="Audrey's Google Plus">
            <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
            </span>
        </a>

        <a href="https://www.linkedin.com/in/audreyauli" title="Audrey's Google Plus">
            <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
            </span>
        </a>
        
        <a href="/assets/images/wechat.jpg" title="Audrey's Wechat">
            <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-weixin fa-stack-1x fa-inverse"></i>
            </span>
        </a>

    </div>

</nav>

    <div id="body-wrap">
      <header class="nav-down"  id="wrapper">
    <a class="navbar-brand" href="/"><img alt="Brand" src="/assets/images/normal/logo-dark-round.png"></a>

    <div class="container-fluid">
       <span class="nav_trigger"><span class="glyphicon glyphicon-menu-hamburger"></span></span>
    </div>
</header>
      

<!-- jumbotron for pages -->

<!-- jumbotron for post page, with feature image -->
  
      <div class="jumbotron jumbotron-post" style="background-image: url('/assets/wp-content/uploads/2015/06/pic.jpg')">
         <div class="fullwidth-wrapper">
    <div class="col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1 col-xs-12 ">
      <div class="main-wrap">
           <h2 class="post-title">A Design Pattern Story in Swift &#8211; Chapter 2: Observer</h2>
            <p class="post-date">29 Jun 2015</p>
      </div>
    </div>
</div>
        
      </div>

  <!-- jumbotron for post page, without feature image -->
  






      <main class="row">
          <div class="col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1 col-xs-12 ">
              <div class="main-wrap">
                <div class="post card">
   <p class="p1">
  <span class="s1">In the deep forest, there is a beautiful witch who was born with the power to tell the past and future. In the beginning she was just a little girl in a nearby village. She knows everyone and whenever she sees danger in the future, she would warn the person. But soon she realized there are simply too many people to warn, and some of which don&#8217;t even want any help.</span>
</p>

<p class="p1">
  <span class="s1">So she told the good people of the village that if they want to know her update, they can tune in to listen to her music station and they shall know the message from the music.</span>
</p>

<div class="highlight"><pre><code class="language-swift" data-lang="swift">//: Define the message  for the all parties
enum WitchMessageType: String {
    case IsChrystalBadLuck = &quot;Bad_Luck&quot;
    case IsChrystalGoodLuck = &quot;Good_Luck&quot;
    case StationCreated = &quot;Station_Created&quot;
    case StationDestroyed = &quot;Station_Destroyed&quot;
}
class WitchMessage {
    let type: WitchMessageType
    let data: Any?
    init(type: WitchMessageType, data: Any?) {
        self.type = type
        self.data = data
    }
}


//: the Good Witch will tell everybody the name of the person she tells fortune for. Bad witch may not.
class GoodWitchMessage: WitchMessage {
    var name: String
    var isBadLuck: Bool { return self.type == WitchMessageType.IsChrystalBadLuck }
    
    init(name: String, type: WitchMessageType, data: Any?){
        self.name = name
        super.init(type: type, data: data)
    }
}

// People who listen to her music station are observers
protocol Observer {
    var name:String { get }
    func notify(witchMessage: WitchMessage)
}


extension CustomStringConvertible where Self: Observer {
    var description: String { return self.name }
}


protocol Station {
    func addObserver(observers: Observer...)
    func removerObserver(observer: Observer)
}


class BaseStation: Station, CustomStringConvertible {
    private var observers: [Observer] = []
    var description: String { return &quot;I am a Station and my observers are: \(observers)&quot; }
    private var orderedQueue = dispatch_queue_create(&quot;orQ&quot;, DISPATCH_QUEUE_CONCURRENT)
    
    //: She can only add or remove one person at a time
    func addObserver(observers: Observer...) {
        dispatch_barrier_sync(orderedQueue) {
            observers.map { self.observers.append($0) }
        }
    }
    
    
    func removerObserver(observer: Observer) {
        dispatch_barrier_sync(orderedQueue) { () -&amp;gt; Void in
            self.observers.filter{ $0.name == observer.name}
            print(&quot;removed observer \(observer.name)&quot;)
        }
    }
    func sendNotificationToAll(witchMessage: WitchMessage) {
        dispatch_sync(orderedQueue) { () -&amp;gt; Void in
            self.observers.map{ $0.notify(witchMessage) }
        }
    }
}

class WitchStation: BaseStation {
    
    func checkCrystalBall(name: String) -&amp;gt; Bool {
        var messageType = WitchMessageType.IsChrystalGoodLuck
        
        if RandomYesOrNoGeneratorByInt.random() {
            print(&quot;Witch Tell: Good luck ahead&quot;)
        } else {
            messageType = WitchMessageType.IsChrystalBadLuck
            print(&quot;Witch Tell: Bad luck ahead&quot;)
        }
        
        sendNotificationToAll(GoodWitchMessage(name: name, type: messageType, data: nil))
        return messageType == WitchMessageType.IsChrystalGoodLuck
    }
}

//: all that listen to her messages
class Villager: Observer {
    var name: String
    init(name: String){
        self.name = name
    }
    func notify(witchMessage: WitchMessage) {
        print(&quot;Villager \(name) got notified&quot;)
        guard let message = witchMessage as? GoodWitchMessage else {
            print(&quot;This message might come from the Bad Witch&quot;)
            return
        }
        print(&quot;Message for \(message.name). Is Bad Luck? \(witchMessage.type)&quot;)
    }
    
    func logMyFortune(fortune: String) {
        print(&quot;Log: \(fortune)&quot;)
    }
}

class AlarmSystem: Observer {
    var name: String
    init(name: String){
        self.name = name
    }
    func notify(witchMessage: WitchMessage) {
        print(&quot;\(name) got notified&quot;)
        guard let message = witchMessage as? GoodWitchMessage else {
            print(&quot;This message might come from the Bad Witch&quot;)
            return
        }
        if witchMessage.type == WitchMessageType.IsChrystalBadLuck  {
            print(&quot;Something unfortunate will happen to \(message.name). An alarm is being sent out&quot;)
        }
    }
}

class Hero: Observer {
    var name: String
    init(name: String){
        self.name = name
    }
    func notify(witchMessage: WitchMessage) {
        print(&quot;Hero got notified&quot;)
        if witchMessage.type == WitchMessageType.IsChrystalBadLuck {
            saveTheUnfortunate()
        }
    }
    func saveTheUnfortunate() {
        print(&quot;A hero will come to save you&quot;)
    }
}

//: Test the system
let jane = Villager(name: &quot;Jane&quot;)
let alarm = AlarmSystem(name: &quot;Alarm System&quot;)
let jack = Hero(name: &quot;Hero Jack&quot;)

let witchStation = WitchStation()
witchStation.addObserver(jane, alarm, jack)
print(witchStation.description)
print(&quot;--check luck for Nicole ---&quot;)
witchStation.checkCrystalBall(&quot;Nicole&quot;)

print(&quot;---check luck for Mia --&quot;)
witchStation.checkCrystalBall(&quot;Mia&quot;)</code></pre></div>

<p>&nbsp;</p>

<p><a href="/assets/wp-content/uploads/2015/06/Observer-Pattern.png"><img class="aligncenter size-full wp-image-962" src="/assets/wp-content/uploads/2015/06/Observer-Pattern.png" alt="Observer Pattern" width="489" height="227" /></a></p>

<p>&nbsp;</p>

<p><a href="https://hdwallpapers.cat/do_not_listen_to_him_forest_girl_fruit_hd-wallpaper-1852331/">Image</a></p>

 </div>
 <div class="related">
   <h2>Related Posts</h2>
   <ul class="related-posts">
     
       <li>
         <h3>
           <a href="/2015/07/18/a-design-pattern-story-in-swift-chapter-21-interpretor/">
             A Design Pattern Story in Swift – Chapter 21: Interpretor
             <small>18 Jul 2015</small>
           </a>
         </h3>
       </li>
     
       <li>
         <h3>
           <a href="/2015/07/18/a-design-pattern-story-in-swift-chapter-20-mediator/">
             A Design Pattern Story in Swift – Chapter 20: Mediator
             <small>18 Jul 2015</small>
           </a>
         </h3>
       </li>
     
       <li>
         <h3>
           <a href="/2015/07/17/a-design-pattern-story-in-swift-chapter-19-flyweight/">
             A Design Pattern Story in Swift – Chapter 19: Flyweight
             <small>17 Jul 2015</small>
           </a>
         </h3>
       </li>
     
   </ul>
 </div>
 <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'audreyli';
    
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
      
    




              </div>
          </div>
          
      </main>

      <footer class="row">
    <div class="col-md-8 col-md-offset-2 text-center">
        &copy Copyright 2015 &nbsp; &nbsp; AudreyLi.me &nbsp; &nbsp;<a href="mailto:me@audreyli.me">Get in touch</a>
    </div>
    
</footer>


      <!-- Latest compiled and minified JavaScript -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<!-- JS -->
<!-- build:js /assets/javascript/all.min.js -->
<script src="/assets/javascript/javascript.js"></script> 
<script src="/assets/javascript/main.js"></script> 
<!-- endbuild -->
  </div>
  </body>
</html>
